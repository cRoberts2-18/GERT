{% extends "layout.html" %}
{% block content %}

<div id="mySidebar" class="sidebar" style="width:400px; padding-top:20px;">
  <input class="sidebutton" type="Button" id="Search" value="Search" onclick="Search()">&emsp;<input class="sidebutton" type="button" id="ViewData" value="Data" onclick="Data()"><br><br><br>
  <a id="dataText">Below is the filepath that we will download from</a>
  <a id="dataText2" style="font-size:15px;">{{ download }}</a>
  <a id="searchText" style="display:none;">Displayed Below are the coordinates selected from the map</a>
  <label id="LongLabel" for="long" style="display:none;">Longitude: </label><input type="number" name="long" id="Long" value="0" style="display:none;" readonly><br>
  <label id="LatLabel" for="lat" style="display:none;">Latitude: </label><input type="number" name="lat" id="Lat" value="0" style="display:none;" readonly><br><br>
  <input class="buttonstyle" type="button" style="display:none;" id = "GetData" value = "Get Location Data">
  
</div>

<div id="map" class='map'></div>

<script>
	
		  
    function notifyMessage(msg,styles){
                 $.notify(msg,{
                 className: styles,
                 globalPosition: 'right center'
                        
                 });
     }
	
	
	function Search(){	  
	  document.getElementById("dataText").style.display="none";
	  document.getElementById("dataText2").style.display="none";
	  document.getElementById("searchText").style.display="block";
	  document.getElementById("LongLabel").style.display="block";	
	  document.getElementById("Long").style.display="block";
	  document.getElementById("Lat").style.display="block";
	  document.getElementById("LatLabel").style.display="block";
	  document.getElementById("GetData").style.display="block";	
	  
	  }	
	function Data(){	  
	  document.getElementById("dataText").style.display="block";
	  document.getElementById("dataText2").style.display="block";
	  document.getElementById("searchText").style.display="none";
	  document.getElementById("LongLabel").style.display="none";	
	  document.getElementById("Long").style.display="none";
	  document.getElementById("Lat").style.display="none";
	  document.getElementById("LatLabel").style.display="none";
	  document.getElementById("GetData").style.display="none";
	  }	

	 var map = L.map('map',{
        center: [52.770775, -1.2043467],
        zoom: 5,
        zoomControl: false
	    
    });
    L.control.zoom({position: 'topright'}).addTo(map);
    
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    }).addTo(map);
    
    var BoundingBox = L.rectangle([[52.8, -1.266], [52.74, -1.18]], {color: "#ff00dd", weight: 1});
	  map.addLayer(BoundingBox);
	
	  var xy1 = [52.8, -1.266];
	  var xy2 = [52.74, -1.18];
	  var boxBounds = [xy1, xy2];   

function onMapClickFirst(e) {
	lat=parseFloat(e.latlng.wrap().lat);
	lon=parseFloat(e.latlng.wrap().lng);
	document.getElementById("Lat").value=lat;
	document.getElementById("Long").value=lon;
	xy1 = xy2;
	xy2 = e.latlng.wrap();
	boxBounds = [xy1, xy2];
	BoundingBox.setBounds(boxBounds);
        notifyMessage("You clicked the map at " + e.latlng.wrap(), "info");
    }
    
    map.on('click', onMapClickFirst);

	
$(function() {
		$("#GetData").click(function () {
			var $lat = $("#Lat").val(); 
    			var $long = $("#Long").val(); 
			var $path = "{{ download }}";
    	   	$.ajax({
    			method: "POST",
      			url: "{{ url_for('searchData')}}",
			data: {"lat":$lat,"long":$long,"path":$path}
      			
   		})
		.done(function(msg) {
			alert(msg);
			//$("#Data").text(msg);
			//$("#Data").removeAttr('hidden');	
		})   
		.fail(function(msg){
			alert(msg);
		});
		});
 
	});	
	
	
</script>
{% endblock %}
